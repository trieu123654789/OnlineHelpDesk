@model OnlineHelpDesk2.Models.Facility
@{
    ViewBag.Title = "DeleteFacility";
    Layout = "~/Views/Shared/Admin_LayoutPage.cshtml";
    var db = new OnlineHelpDesk2.Models.OHDDBContext();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Close Request</title>
    <meta name="description" content="" />
    <meta name="author" content="Tooplate" />
    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Additional CSS Files -->
    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet" />
    <link rel="stylesheet" href="../Content/fontawesome.css" />
    <link rel="stylesheet" href="../Content/style2.css" />
    <link rel="stylesheet" href="../Content/css/owl.css" />
    <link rel="stylesheet" href="../Content/lightbox.css" />

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
        }

        #page-wraper {
            background: #4AA0DD no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h3 {
            text-align: center;
        }

        .card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            width: 570px;
            margin: 0 auto
        }

        .card-body {
            padding: 20px;
        }

        form {
            max-width: 500px;
            margin: 0 auto;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }

        input[type="submit"] {
            display: inline-block;
            padding: 10px 20px;
            text-decoration: none;
            color: #fff;
            background-color: #28a745;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

            input[type="submit"]:hover {
                background-color: #228B22;
            }

        input[type="button"] {
            display: inline-block;
            padding: 10px 20px;
            text-decoration: none;
            color: #fff;
            background-color: #ff0000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

            input[type="button"]:hover {
                background-color: #B80000;
            }

        .custom-table {
            border: 1px solid #ddd;
            border-collapse: collapse;
            width: 100%;
        }

            .custom-table th, .custom-table td {
                border: 1px solid #ddd;
                padding: 8px;
                text-align: left;
            }
    </style>

</head>
<body>
    <div id="page-wraper">
        <div class="container">
            <h3 style="color: #fff">Are you sure you want to delete this facility?</h3>
            <div class="card">
                <div class="card-body">
                    <form>
                        <h2>Facility</h2>
                        <table class="custom-table">
                            <tbody>
                                <tr>
                                    <th class="col-md-9">@Html.DisplayNameFor(model => model.FacilityName)</th>
                                    <td class="col-md-9">@Html.DisplayFor(model => model.FacilityName)</td>
                                </tr>
                            </tbody>
                        </table>
                        <br />
                        @using (Html.BeginForm())
                        {
                            @Html.AntiForgeryToken()
                            <p>
                                <strong>Warning:</strong> Deleting this facility will also delete the associated accounts.
                            </p>

                            <p>
                                <strong>Number of associated accounts:</strong> @(db.Accounts.Count(a => a.FacilityID == Model.FacilityID))
                            </p>
                            <br />

                            <div class="form-actions no-color">
                                <input type="submit" value="Delete" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this facility and its associated accounts?')" />
                                @{
                                    // Delete associated accounts directly in the confirmation logic
                                    if (Request.HttpMethod == "POST")
                                    {
                                        var associatedAccounts = db.Accounts.Where(a => a.FacilityID == Model.FacilityID).ToList();
                                        db.Accounts.RemoveRange(associatedAccounts);
                                        db.SaveChanges();
                                    }
                                }
                                <input class="badge badge-btn2" onclick="location.href='@Url.Action("Facilities", "Admin")'" type="button" value="Cancel" />
                            </div>
                        }
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Scripts -->
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <script src="../assets/js/isotope.min.js"></script>
    <script src="../assets/js/owl-carousel.js"></script>
    <script src="../assets/js/lightbox.js"></script>
    <script src="../assets/js/custom.js"></script>

</body>
</html>